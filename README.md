# Advent Of Code

This is a small framework to help with [Advent of
Code](https://adventofcode.com/) by managing inputs, tests and boilerplate code
while you focus on problem solving in a TDD fashion.

- [Installation](#installation)
  - [Install the library](#install-the-library)
  - [Configuration](#configuration)
  - [Test configuration](#test-configuration)
  - [Install your cookie](#install-your-cookie)
- [Use the commands](#use-the-commands)
  - [mix aoc.open](#mix-aocopen)
  - [mix aoc.create](#mix-aoccreate)
  - [mix aoc.test](#mix-aoctest)
  - [mix aoc.run](#mix-aocrun)
  - [mix aoc.fetch](#mix-aocfetch)
  - [mix aoc.url](#mix-aocurl)
- [Defaults management command](#defaults-management-command)
- [Writing solutions](#writing-solutions)


## Installation


### Install the library

This framework is distributed as a library as it consists mostly of mix tasks.
You may add the dependency to your project, or add it to a new project created
with `mix new my_app`.

```elixir
defp deps do
  [
    {:aoc, "~> 0.11"},
  ]
end
```


### Configuration

If it does not exist, create a configuration file in your application:

```
mkdir -p config
touch config/config.exs
```

Then add the following configuration:

```elixir
import Config

# The prefix is used when creating solutions and test modules with
# `mix aoc.create`.
config :aoc, prefix: MyApp
```


### Test configuration

In order to run the `aoc.test` command described later in this document, you
need to declare that command as a test environment command.

In your`mix.exs` file, declare the following function:

```elixir
# mix.exs
def cli do
  [
    preferred_envs: ["aoc.test": :test]
  ]
end
```


### Install your cookie

Retrieve your cookie from the AoC website (with you browser developer tools) and write the session
ID in `$HOME/.adventofcode.session`. It should be a long hex number like
`53616c7465645f5f1d5792d97e3370392425dea84ca4653bd9a083f164ecd92278bef5b6bd50...`


## Use the commands

The following commands will use default `year` and `day` based on the current date.

It is possible to override the defaults with the `mix aoc.set` command, or
provide the `--year` and `--day` options to any of them.


### mix aoc.open

Opens the problem page on AoC website.


### mix aoc.create

Creates the solution file, the test file and the input file for the current day.

The input is downloaded from the AoC website and requires the session cookie.

You can also create any of those files manually and the command will not
overwrite them.


### mix aoc.test

Runs the tests. This relies on the `mix test` command and will call it with the
default test filename that would be generated byt `mix aoc.create`.

Supports the `--trace`, `--failed`, `--stale`, `--seed` and `--max-failures`
options of `mix test`.


### mix aoc.run

Runs the solution. There are more options available:

* `-p, --part` to run only one part
* `-b, --benchmark` to run the solution multiple times and print statisticsd
  thanks to [Benchee](https://hex.pm/packages/benchee).


### mix aoc.fetch

Downloads the input. This will not overwrite an existing file. Inputs are stored
in the `priv/inputs` directory.


### mix aoc.url

Prints the URL of the problem.

Note that due to Elixir compilation outputs you may need to grep for the URL.
For instance `xdg-open $(mix aoc.url | grep 'https')`.




## Defaults management command

The `mix aoc.set` command allows to set the default year and day. Those values
are used by default when other commands are not called with `--year` or `--day`
options.

This is useful when working on a problem from a previous year, or when you
finish the last days after December 25th, so your CLI history or bash scripts
can just call `mix aoc.test` or `mix aoc.run` without options.

* `mix aoc.set --year 2022` – Set the default year to 2022.
* `mix aoc.set --day 12` – Set the default day.
* `mix aoc.set --year 2022 --day 12` – Set both defaults.
* `mix aoc.set --reset --day 12` – Set the default day and delete other default values.
* `mix aoc.set --reset` – Delete every default values.


## Writing solutions

The `mix aoc.create` command will generate modules with the boilerplate code to
be called by `mix aoc.run` and the generated tests.

```elixir
defmodule MyApp.Y24.Day01 do
  alias AoC.Input

  def parse(input, _part) do
    # This function will receive the input path or an %AoC.Input.TestInput{}
    # struct.  To support the test you may read both types of input with either:
    #
    # * Input.stream!(input), equivalent to File.stream!/1
    # * Input.stream!(input, trim: true), equivalent to File.stream!/2
    # * Input.read!(input), equivalent to File.read!/1
    #
    # The role of your parse/2 function is to return a "problem" for the solve/2
    # function.
    #
    # For instance:
    #
    # input
    # |> Input.stream!()
    # |> Enum.map!(&my_parse_line_function/1)

    Input.read!(input)
  end

  def part_one(problem) do
    # This function receives the problem returned by parse/2 and must return
    # today's problem solution for part one.
    problem
  end

  # def part_two(problem) do
  #   problem
  # end
end
```

Note: You can generate modules without the help comments by passing the `-C` flag in `mix aoc.create`.

To call your code manually, you may use the following code:

```elixir
solution_for_p1 =
  "path/to/input/file"
  |> MyApp.Y23.Day1.parse(:part_one)
  |> MyApp.Y23.Day1.part_one()
```
